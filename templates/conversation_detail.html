{% extends "base.html" %}
{% block content %}
<section class="card">
  <div class="split">
    <div>
      <h2>{{ conversation.title }}</h2>
      <p class="muted">Source: {{ conversation.source }}</p>
    </div>
    <div class="row-actions">
      <a href="/p/{{ project.slug }}/conversations">All conversations</a>
    </div>
  </div>
</section>

<section class="card">
  <h3>Chat</h3>
  {% if error %}
    <p class="error">{{ error }}</p>
  {% endif %}
  {% if turns %}
    <ul class="chat-thread">
      {% for turn in turns %}
        <li class="chat-turn chat-turn-{{ turn.role }}">
          <div class="chat-meta">
            <span class="pill">{{ turn.role }}</span>
            <span class="muted">{{ turn.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
          </div>
          <p>{{ turn.content_text }}</p>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="muted">No messages yet. Send the first one below.</p>
  {% endif %}
</section>

<section class="card">
  <h3>Send message</h3>
  <form method="post" action="/p/{{ project.slug }}/conversations/{{ conversation.id }}/messages" class="form-grid">
    <label>
      Message
      <textarea name="message" rows="4" required></textarea>
    </label>
    <button type="submit">Send</button>
  </form>
</section>
{% endblock %}
