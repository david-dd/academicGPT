{% extends "base.html" %}

{% block content %}
<section class="card">
  <h2>Search</h2>
  <form
    method="get"
    action="/p/{{ project.slug }}/search"
    class="form-inline"
    hx-get="/p/{{ project.slug }}/search/results"
    hx-target="#search-results"
    hx-swap="innerHTML"
    hx-push-url="true"
  >
    <input
      type="text"
      name="q"
      value="{{ query or '' }}"
      placeholder="Search turns & text blocks"
      required
      hx-trigger="keyup changed delay:300ms"
      hx-get="/p/{{ project.slug }}/search/results"
      hx-target="#search-results"
      hx-swap="innerHTML"
      hx-include="closest form"
      hx-push-url="true"
    />
    <button type="submit">Search</button>
  </form>
</section>

<div id="search-results">
  {% include "search/results.html" %}
</div>

<section class="card">
  <h3>Switch Project</h3>
  <ul class="list">
    {% for entry in projects %}
      <li class="list-item">
        <div>
          <strong>{{ entry.name }}</strong>
          <p class="muted">{{ entry.description or "No description" }}</p>
        </div>
        {% if entry.id == project.id %}
          <span class="pill pill-ok">Current</span>
        {% else %}
          <a href="/p/{{ entry.slug }}/search?q={{ query or '' }}">Search</a>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</section>
{% endblock %}
