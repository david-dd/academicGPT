<div class="block-header">
  <div>
    <h3>{{ block.title }}</h3>
    <p class="muted">Zuletzt aktualisiert: {{ block.updated_at.strftime("%d.%m.%Y %H:%M") }}</p>
  </div>
  <div class="pill-group">
    {% if block.archived %}
      <span class="pill pill-warn">Archiviert</span>
    {% endif %}
    <span class="pill">{{ block.status }}</span>
  </div>
  
</div>

<div class="meta-grid">
  <div>
    <p class="muted">TB-ID</p>
    <strong>{{ block.tb_id }}</strong>
  </div>
  <div>
    <p class="muted">Typ</p>
    <strong>{{ block.type }}</strong>
  </div>
  <div>
    <p class="muted">Status</p>
    <strong>{{ block.status }}</strong>
  </div>
  <div>
    <p class="muted">Archiviert</p>
    <strong>{{ "Ja" if block.archived else "Nein" }}</strong>
  </div>
</div>

<section class="card-inline">
  <div>
    <p class="muted">Working-Text</p>
    <p>{{ block.working_text or "Noch kein Working-Text hinterlegt." }}</p>
  </div>
  <div>
    <p class="muted">Notes</p>
    <p>{{ block.notes or "Noch keine Notes hinterlegt." }}</p>
  </div>

</section>

<section id="block-links" class="stack">
  {% include "text_blocks/links.html" %}
</section>

{% if search_highlights %}
<section class="subcard search-highlights">
  <h4>Suchtreffer</h4>
  <ul class="list">
    {% for match in search_highlights %}
      <li>
        <p class="muted">{{ match.label }}</p>
        <p class="search-snippet">{{ match.content_html }}</p>
      </li>
    {% endfor %}
  </ul>
</section>
{% endif %}

<details class="section-details">
  <summary>
    <span>Bearbeitung öffnen</span>
    <span aria-hidden="true">⚙️</span>
  </summary>
  <form
    method="post"
    action="/p/{{ project.slug }}/blocks/{{ block.id }}"
    class="form-grid"
    hx-post="/p/{{ project.slug }}/blocks/{{ block.id }}"
    hx-target="closest .tabs-detail"
    hx-swap="innerHTML"
  >
    <label>
      Titel
      <input type="text" name="title" value="{{ block.title }}" required>
    </label>
    <div class="form-inline">
      <label class="grow">
        Typ
        <select name="block_type" required>
          {% if block.type and block.type not in block_types %}
            <option value="{{ block.type }}" selected>{{ block.type }}</option>
          {% endif %}
          {% for option in block_types %}
            <option value="{{ option }}" {% if option == block.type %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="grow">
        Status
        <select name="status" required>
          {% if block.status and block.status not in block_statuses %}
            <option value="{{ block.status }}" selected>{{ block.status }}</option>
          {% endif %}
          {% for option in block_statuses %}
            <option value="{{ option }}" {% if option == block.status %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </label>
    </div>
    <label>
      Working-Text
      <textarea name="working_text" rows="6">{{ block.working_text or "" }}</textarea>
    </label>
    <label>
      Notes
      <textarea name="notes" rows="4">{{ block.notes or "" }}</textarea>
    </label>
    <button type="submit">Textbaustein speichern</button>
  </form>

  <form
    method="post"
    action="/p/{{ project.slug }}/blocks/{{ block.id }}/archive"
    class="form-inline"
    hx-post="/p/{{ project.slug }}/blocks/{{ block.id }}/archive"
    hx-target="closest .tabs-detail"
    hx-swap="innerHTML"
  >
    {% if block.archived %}
      <input type="hidden" name="archived" value="false">
      <button type="submit">Archivierung aufheben</button>
    {% else %}
      <input type="hidden" name="archived" value="true">
      <button type="submit">Textbaustein archivieren</button>
    {% endif %}
  </form>
</details>
