<section class="card-inline">
  <div class="split">
    <h4>Verkn端pfte Konversationen</h4>
  </div>
  <form
    method="get"
    action="/p/{{ project.slug }}/blocks/{{ block.id }}/links"
    class="form-inline"
    hx-get="/p/{{ project.slug }}/blocks/{{ block.id }}/links"
    hx-target="#block-links"
    hx-swap="innerHTML"
  >
    <label>
      Relation
      <select name="relation">
        <option value="all" {% if link_relation == "all" %}selected{% endif %}>Alle</option>
        {% for relation in relation_types %}
          <option value="{{ relation }}" {% if link_relation == relation %}selected{% endif %}>
            {{ relation }}
          </option>
        {% endfor %}
      </select>
    </label>
    <label class="grow">
      Suche
      <input type="search" name="q" value="{{ link_query }}" placeholder="Konversationstitel">
    </label>
    <button type="submit">Filtern</button>
  </form>
</section>

<section class="card-inline">
  <h4>Konversation hinzuf端gen</h4>
  <form
    method="post"
    action="/p/{{ project.slug }}/blocks/{{ block.id }}/links"
    class="form-grid"
    hx-post="/p/{{ project.slug }}/blocks/{{ block.id }}/links"
    hx-target="#block-links"
    hx-swap="innerHTML"
  >
    <label>
      Bestehende Konversation
      <select name="conversation_id">
        <option value="">Neue Konversation erstellen</option>
        {% for convo in project_conversations %}
          <option value="{{ convo.id }}">{{ convo.title }}</option>
        {% endfor %}
      </select>
    </label>
    <label>
      Neuer Titel (nur bei neuer Konversation)
      <input type="text" name="new_title">
    </label>
    <label>
      Relationstyp
      <select name="relation" required>
        {% for relation in relation_types %}
          <option value="{{ relation }}">{{ relation }}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">Konversation hinzuf端gen</button>
  </form>
</section>

<ul class="list">
  {% for link in links %}
    <li>
      <div class="list-item">
        <div>
          <strong>{{ link.conversation.title }}</strong>
          <p class="muted">Relation: {{ link.relation }}</p>
        </div>
        <form
          method="post"
          action="/p/{{ project.slug }}/blocks/{{ block.id }}/links/{{ link.id }}"
          class="form-inline"
          hx-post="/p/{{ project.slug }}/blocks/{{ block.id }}/links/{{ link.id }}"
          hx-target="#block-links"
          hx-swap="innerHTML"
        >
          <select name="relation">
            {% for relation in relation_types %}
              <option value="{{ relation }}" {% if link.relation == relation %}selected{% endif %}>
                {{ relation }}
              </option>
            {% endfor %}
          </select>
          <button type="submit">Aktualisieren</button>
        </form>
      </div>
    </li>
  {% else %}
    <li class="muted">Keine verkn端pften Konversationen.</li>
  {% endfor %}
</ul>
