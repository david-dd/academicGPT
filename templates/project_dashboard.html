{% extends "base.html" %}
{% block content %}
<section class="card">
  <div class="split">
    <div>
      <h2>{{ project.name }}</h2>
      <p class="muted">{{ project.description or "No description yet." }}</p>
    </div>
    <div class="row-actions">
      <a href="/p/{{ project.slug }}/settings">Edit settings</a>
      <a href="/p/{{ project.slug }}/export">Export</a>
    </div>
  </div>
  <div class="stats-grid">
    <div class="stat">
      <p class="stat-label">Textbausteine</p>
      <p class="stat-value">{{ stats.text_blocks }}</p>
    </div>
    <div class="stat">
      <p class="stat-label">Konversationen</p>
      <p class="stat-value">{{ stats.conversations }}</p>
    </div>
    <div class="stat">
      <p class="stat-label">Turns</p>
      <p class="stat-value">{{ stats.turns }}</p>
    </div>
    <div class="stat">
      <p class="stat-label">Key-Status</p>
      <p class="stat-value">
        {% if has_key %}
          <span class="pill pill-ok">gesetzt</span>
        {% else %}
          <span class="pill pill-warn">fehlt</span>
        {% endif %}
      </p>
    </div>
  </div>
</section>

<section class="card">
  <h3>Text Blocks</h3>
  {% if text_blocks_overview %}
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>CrateDate</th>
            <th>ID</th>
            <th>Beschreibung (Note)</th>
            <th>Konversationen</th>
            <th>Turns (Summe)</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          {% for entry in text_blocks_overview %}
            <tr>
              <td>{{ entry.block.created_at.strftime("%d.%m.%Y %H:%M") }}</td>
              <td>{{ entry.block.tb_id }}</td>
              <td>
                <strong>{{ entry.block.title }}</strong>
                <p class="muted">{{ entry.block.notes or "Noch keine Notiz." }}</p>
              </td>
              <td>{{ entry.conversation_count }}</td>
              <td>{{ entry.turn_count }}</td>
              <td><a href="/p/{{ project.slug }}/blocks/{{ entry.block.id }}">Ã–ffnen</a></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted">Noch keine Textbausteine vorhanden.</p>
  {% endif %}
</section>

<section class="card">
  <h3>Conversations</h3>
  <p class="muted">Create or revisit conversations tied to this project.</p>
  <a href="/p/{{ project.slug }}/conversations">Open conversations</a>
</section>

<section class="card">
  <h3>Add Text Block</h3>
  <form method="post" action="/p/{{ project.slug }}/blocks" class="form-grid">
    <label>
      Title
      <input type="text" name="title" required>
    </label>
    <label>
      Notes
      <textarea name="notes" rows="3"></textarea>
    </label>
    <button type="submit">Add Block</button>
  </form>
</section>

<section class="card">
  <h3>Switch Project</h3>
  <ul class="list">
    {% for entry in projects %}
      <li class="list-item">
        <div>
          <strong>{{ entry.name }}</strong>
          <p class="muted">{{ entry.description or "No description" }}</p>
        </div>
        {% if entry.id == project.id %}
          <span class="pill pill-ok">Current</span>
        {% else %}
          <a href="/p/{{ entry.slug }}/dashboard">Open</a>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</section>
{% endblock %}
